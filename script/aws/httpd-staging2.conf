# Based on the Ubuntu apache2.conf

ServerRoot "/etc/httpd"

# The accept serialization lock file MUST BE STORED ON A LOCAL DISK.
#
LockFile /var/run/httpd/accept.lock

# PidFile: The file in which the server should record its process
# identification number when it starts.
#
PidFile /var/run/httpd/httpd.pid

# Timeout: The number of seconds before receives and sends time out.
#
Timeout 300

# KeepAlive: Whether or not to allow persistent connections (more than
# one request per connection). Set to "Off" to deactivate.
#
KeepAlive Off


# MaxKeepAliveRequests: The maximum number of requests to allow
# during a persistent connection. Set to 0 to allow an unlimited amount.
# We recommend you leave this number high, for maximum performance.
#
MaxKeepAliveRequests 0


# KeepAliveTimeout: Number of seconds to wait for the next request from the
# same client on the same connection.
#
KeepAliveTimeout 2

# AccessFileName: The name of the file to look for in each directory
# for additional configuration directives.  See also the AllowOverride
# directive.
#
AccessFileName .htaccess

# The following lines prevent .htaccess and .htpasswd files from being
# viewed by Web clients.
#
<Files ~ "^\.ht">
    Order allow,deny
    Deny from all
</Files>


# DefaultType is the default MIME type the server will use for a document
# if it cannot otherwise determine one, such as from filename extensions.
# If your server contains mostly text or HTML documents, "text/plain" is
# a good value.  If most of your content is binary, such as applications
# or images, you may want to use "application/octet-stream" instead to
# keep browsers from trying to display binary files as though they are
# text.
#
DefaultType text/plain

#
# HostnameLookups: Log the names of clients or just their IP addresses
# e.g., www.apache.org (on) or 204.62.129.132 (off).
# The default is off because it'd be overall better for the net if people
# had to knowingly turn this feature on, since enabling it means that
# each client request will result in AT LEAST one lookup request to the
# nameserver.
#
HostnameLookups Off

# ErrorLog: The location of the error log file.
# If you do not specify an ErrorLog directive within a <VirtualHost>
# container, error messages relating to that virtual host will be
# logged here.  If you *do* define an error logfile for a <VirtualHost>
# container, that host's errors will be logged there and not here.
#
ErrorLog /var/log/httpd/error.log

#
# LogLevel: Control the number of messages logged to the error_log.
# Possible values include: debug, info, notice, warn, error, crit,
# alert, emerg.
#
LogLevel warn

# COOK-1021: Dummy LoadModule directive to aid module installations
#LoadModule dummy_module modules/mod_dummy.so

# Include module configuration:
# Include /etc/httpd/mods-enabled/*.load
# Include /etc/httpd/mods-enabled/*.conf
LoadModule alias_module modules/mod_alias.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authz_default_module modules/mod_authz_default.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule dir_module modules/mod_dir.so
LoadModule env_module modules/mod_env.so
LoadModule expires_module modules/mod_expires.so
LoadModule headers_module modules/mod_headers.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule logio_module modules/mod_logio.so
LoadModule mime_module modules/mod_mime.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule status_module modules/mod_status.so


LoadModule passenger_module /home/ec2-user/.rvm/gems/ruby-1.9.3-p551@rocky6/gems/passenger-3.0.19/ext/apache2/mod_passenger.so
PassengerRoot /home/ec2-user/.rvm/gems/ruby-1.9.3-p551@rocky6/gems/passenger-3.0.19
PassengerRuby /home/ec2-user/.rvm/wrappers/ruby-1.9.3-p551@rocky6/ruby
PassengerMaxPoolSize 60



<IfModule alias_module>
  #
  # Aliases: Add here as many aliases as you need (with no limit). The format is
  # Alias fakename realname
  #
  # Note that if you include a trailing / on fakename then the server will
  # require it to be present in the URL.  So "/icons" isn't aliased in this
  # example, only "/icons/".  If the fakename is slash-terminated, then the
  # realname must also be slash terminated, and if the fakename omits the
  # trailing slash, the realname must also omit it.
  #
  # We include the /icons/ alias for FancyIndexed directory listings.  If
  # you do not use FancyIndexing, you may comment this out.
  #
  Alias /icons/ "/var/www/icons/"

  <Directory "/var/www/icons">
    Options Indexes MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>
</IfModule>
<IfModule mod_autoindex.c>
  #
  # Directives controlling the display of server-generated directory listings.
  #

  #
  # IndexOptions: Controls the appearance of server-generated directory
  # listings.
  # Remove/replace the "Charset=UTF-8" if you don't use UTF-8 for your filenames.
  #
  IndexOptions FancyIndexing VersionSort HTMLTable NameWidth=* DescriptionWidth=* Charset=UTF-8

  #
  # AddIcon* directives tell the server which icon to show for different
  # files or filename extensions.  These are only displayed for
  # FancyIndexed directories.
  #
  AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip x-bzip2

  AddIconByType (TXT,/icons/text.gif) text/*
  AddIconByType (IMG,/icons/image2.gif) image/*
  AddIconByType (SND,/icons/sound2.gif) audio/*
  AddIconByType (VID,/icons/movie.gif) video/*

  AddIcon /icons/binary.gif .bin .exe
  AddIcon /icons/binhex.gif .hqx
  AddIcon /icons/tar.gif .tar
  AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
  AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
  AddIcon /icons/a.gif .ps .ai .eps
  AddIcon /icons/layout.gif .html .shtml .htm .pdf
  AddIcon /icons/text.gif .txt
  AddIcon /icons/c.gif .c
  AddIcon /icons/p.gif .pl .py
  AddIcon /icons/f.gif .for
  AddIcon /icons/dvi.gif .dvi
  AddIcon /icons/uuencoded.gif .uu
  AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
  AddIcon /icons/tex.gif .tex
  # It's a suffix rule, so simply matching "core" matches "score" as well !
  AddIcon /icons/bomb.gif /core
  AddIcon (SND,/icons/sound2.gif) .ogg
  AddIcon (VID,/icons/movie.gif) .ogm

  AddIcon /icons/back.gif ..
  AddIcon /icons/hand.right.gif README
  AddIcon /icons/folder.gif ^^DIRECTORY^^
  AddIcon /icons/blank.gif ^^BLANKICON^^

  # Default icons for OpenDocument format
  AddIcon /icons/odf6odt-20x22.png .odt
  AddIcon /icons/odf6ods-20x22.png .ods
  AddIcon /icons/odf6odp-20x22.png .odp
  AddIcon /icons/odf6odg-20x22.png .odg
  AddIcon /icons/odf6odc-20x22.png .odc
  AddIcon /icons/odf6odf-20x22.png .odf
  AddIcon /icons/odf6odb-20x22.png .odb
  AddIcon /icons/odf6odi-20x22.png .odi
  AddIcon /icons/odf6odm-20x22.png .odm

  AddIcon /icons/odf6ott-20x22.png .ott
  AddIcon /icons/odf6ots-20x22.png .ots
  AddIcon /icons/odf6otp-20x22.png .otp
  AddIcon /icons/odf6otg-20x22.png .otg
  AddIcon /icons/odf6otc-20x22.png .otc
  AddIcon /icons/odf6otf-20x22.png .otf
  AddIcon /icons/odf6oti-20x22.png .oti
  AddIcon /icons/odf6oth-20x22.png .oth

  #
  # DefaultIcon is which icon to show for files which do not have an icon
  # explicitly set.
  #
  DefaultIcon /icons/unknown.gif

  #
  # AddDescription allows you to place a short description after a file in
  # server-generated indexes.  These are only displayed for FancyIndexed
  # directories.
  # Format: AddDescription "description" filename
  #
  #AddDescription "GZIP compressed document" .gz
  #AddDescription "tar archive" .tar
  #AddDescription "GZIP compressed tar archive" .tgz

  #
  # ReadmeName is the name of the README file the server will look for by
  # default, and append to directory listings.
  #
  # HeaderName is the name of a file which should be prepended to
  # directory indexes.
  ReadmeName README.html
  HeaderName HEADER.html

  #
  # IndexIgnore is a set of filenames which directory indexing should ignore
  # and not include in the listing.  Shell-style wildcarding is permitted.
  #
  IndexIgnore .??* *~ *# RCS CVS *,v *,t
</IfModule>
<IfModule mod_deflate.c>
  <IfModule mod_filter.c>
     # these are known to be safe with MSIE 6
     AddOutputFilterByType DEFLATE text/html text/plain text/xml

     # everything else may cause problems with MSIE 6
     AddOutputFilterByType DEFLATE text/css
     AddOutputFilterByType DEFLATE application/x-javascript application/javascript application/ecmascript
     AddOutputFilterByType DEFLATE application/rss+xml
     AddOutputFilterByType DEFLATE application/xml
     AddOutputFilterByType DEFLATE application/xhtml+xml
     AddOutputFilterByType DEFLATE image/svg+xml
     AddOutputFilterByType DEFLATE application/atom_xml
     AddOutputFilterByType DEFLATE application/x-httpd-php
     AddOutputFilterByType DEFLATE application/x-httpd-fastphp
     AddOutputFilterByType DEFLATE application/x-httpd-eruby
  </IfModule>
</IfModule>
<IfModule mod_dir.c>
  DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm
</IfModule>
<IfModule mod_mime.c>
  #
  # TypesConfig points to the file containing the list of mappings from
  # filename extension to MIME-type.
  #
  TypesConfig /etc/mime.types

  #
  # AddType allows you to add to or override the MIME configuration
  # file mime.types for specific file types.
  #
  #AddType application/x-gzip .tgz
  #
  # AddEncoding allows you to have certain browsers uncompress
  # information on the fly. Note: Not all browsers support this.
  # Despite the name similarity, the following Add* directives have
  # nothing to do with the FancyIndexing customization directives above.
  #
  #AddEncoding x-compress .Z
  #AddEncoding x-gzip .gz .tgz
  #AddEncoding x-bzip2 .bz2
  #
  # If the AddEncoding directives above are commented-out, then you
  # probably should define those extensions to indicate media types:
  #
  AddType application/x-compress .Z
  AddType application/x-gzip .gz .tgz
  AddType application/x-bzip2 .bz2

  AddType image/svg+xml svg svgz
  AddEncoding gzip svgz

  #
  # DefaultLanguage and AddLanguage allows you to specify the language of
  # a document. You can then use content negotiation to give a browser a
  # file in a language the user can understand.
  #
  # Specify a default language. This means that all data
  # going out without a specific language tag (see below) will
  # be marked with this one. You probably do NOT want to set
  # this unless you are sure it is correct for all cases.
  #
  # * It is generally better to not mark a page as
  # * being a certain language than marking it with the wrong
  # * language!
  #
  # DefaultLanguage nl
  #
  # Note 1: The suffix does not have to be the same as the language
  # keyword --- those with documents in Polish (whose net-standard
  # language code is pl) may wish to use "AddLanguage pl .po" to
  # avoid the ambiguity with the common suffix for perl scripts.
  #
  # Note 2: The example entries below illustrate that in some cases
  # the two character 'Language' abbreviation is not identical to
  # the two character 'Country' code for its country,
  # E.g. 'Danmark/dk' versus 'Danish/da'.
  #
  # Note 3: In the case of 'ltz' we violate the RFC by using a three char
  # specifier. There is 'work in progress' to fix this and get
  # the reference data for rfc1766 cleaned up.
  #
  # Catalan (ca) - Croatian (hr) - Czech (cs) - Danish (da) - Dutch (nl)
  # English (en) - Esperanto (eo) - Estonian (et) - French (fr) - German (de)
  # Greek-Modern (el) - Hebrew (he) - Italian (it) - Japanese (ja)
  # Korean (ko) - Luxembourgeois* (ltz) - Norwegian Nynorsk (nn)
  # Norwegian (no) - Polish (pl) - Portugese (pt)
  # Brazilian Portuguese (pt-BR) - Russian (ru) - Swedish (sv)
  # Simplified Chinese (zh-CN) - Spanish (es) - Traditional Chinese (zh-TW)
  #
  AddLanguage ca .ca
  AddLanguage cs .cz .cs
  AddLanguage da .dk
  AddLanguage de .de
  AddLanguage el .el
  AddLanguage en .en
  AddLanguage eo .eo
  # See README.Debian for Spanish
  AddLanguage es .es
  AddLanguage et .et
  AddLanguage fr .fr
  AddLanguage he .he
  AddLanguage hr .hr
  AddLanguage it .it
  AddLanguage ja .ja
  AddLanguage ko .ko
  AddLanguage ltz .ltz
  AddLanguage nl .nl
  AddLanguage nn .nn
  AddLanguage no .no
  AddLanguage pl .po
  AddLanguage pt .pt
  AddLanguage pt-BR .pt-br
  AddLanguage ru .ru
  AddLanguage sv .sv
  # See README.Debian for Turkish
  AddLanguage tr .tr
  AddLanguage zh-CN .zh-cn
  AddLanguage zh-TW .zh-tw

  #
  # Commonly used filename extensions to character sets. You probably
  # want to avoid clashes with the language extensions, unless you
  # are good at carefully testing your setup after each change.
  # See http://www.iana.org/assignments/character-sets for the
  # official list of charset names and their respective RFCs.
  #
  AddCharset us-ascii    .ascii .us-ascii
  AddCharset ISO-8859-1  .iso8859-1  .latin1
  AddCharset ISO-8859-2  .iso8859-2  .latin2 .cen
  AddCharset ISO-8859-3  .iso8859-3  .latin3
  AddCharset ISO-8859-4  .iso8859-4  .latin4
  AddCharset ISO-8859-5  .iso8859-5  .cyr .iso-ru
  AddCharset ISO-8859-6  .iso8859-6  .arb .arabic
  AddCharset ISO-8859-7  .iso8859-7  .grk .greek
  AddCharset ISO-8859-8  .iso8859-8  .heb .hebrew
  AddCharset ISO-8859-9  .iso8859-9  .latin5 .trk
  AddCharset ISO-8859-10  .iso8859-10  .latin6
  AddCharset ISO-8859-13  .iso8859-13
  AddCharset ISO-8859-14  .iso8859-14  .latin8
  AddCharset ISO-8859-15  .iso8859-15  .latin9
  AddCharset ISO-8859-16  .iso8859-16  .latin10
  AddCharset ISO-2022-JP .iso2022-jp .jis
  AddCharset ISO-2022-KR .iso2022-kr .kis
  AddCharset ISO-2022-CN .iso2022-cn .cis
  AddCharset Big5        .Big5       .big5 .b5
  AddCharset cn-Big5     .cn-big5
  # For russian, more than one charset is used (depends on client, mostly):
  AddCharset WINDOWS-1251 .cp-1251   .win-1251
  AddCharset CP866       .cp866
  AddCharset KOI8      .koi8
  AddCharset KOI8-E      .koi8-e
  AddCharset KOI8-r      .koi8-r .koi8-ru
  AddCharset KOI8-U      .koi8-u
  AddCharset KOI8-ru     .koi8-uk .ua
  AddCharset ISO-10646-UCS-2 .ucs2
  AddCharset ISO-10646-UCS-4 .ucs4
  AddCharset UTF-7       .utf7
  AddCharset UTF-8       .utf8
  AddCharset UTF-16      .utf16
  AddCharset UTF-16BE    .utf16be
  AddCharset UTF-16LE    .utf16le
  AddCharset UTF-32      .utf32
  AddCharset UTF-32BE    .utf32be
  AddCharset UTF-32LE    .utf32le
  AddCharset euc-cn      .euc-cn
  AddCharset euc-gb      .euc-gb
  AddCharset euc-jp      .euc-jp
  AddCharset euc-kr      .euc-kr
  #Not sure how euc-tw got in - IANA doesn't list it???
  AddCharset EUC-TW      .euc-tw
  AddCharset gb2312      .gb2312 .gb
  AddCharset iso-10646-ucs-2 .ucs-2 .iso-10646-ucs-2
  AddCharset iso-10646-ucs-4 .ucs-4 .iso-10646-ucs-4
  AddCharset shift_jis   .shift_jis .sjis

  #
  # AddHandler allows you to map certain file extensions to "handlers":
  # actions unrelated to filetype. These can be either built into the server
  # or added with the Action directive (see below)
  #
  # To use CGI scripts outside of ScriptAliased directories:
  # (You will also need to add "ExecCGI" to the "Options" directive.)
  #
  #AddHandler cgi-script .cgi

  #
  # For files that include their own HTTP headers:
  #
  #AddHandler send-as-is asis

  #
  # For server-parsed imagemap files:
  #
  #AddHandler imap-file map

  #
  # For type maps (negotiated resources):
  # (This is enabled by default to allow the Apache "It Worked" page
  #  to be distributed in multiple languages.)
  #
  AddHandler type-map var

  #
  # Filters allow you to process content before it is sent to the client.
  #
  # To parse .shtml files for server-side includes (SSI):
  # (You will also need to add "Includes" to the "Options" directive.)
  #
  AddType text/html .shtml
  AddOutputFilter INCLUDES .shtml
</IfModule>
<IfModule mod_negotiation.c>
  #
  # LanguagePriority allows you to give precedence to some languages
  # in case of a tie during content negotiation.
  #
  # Just list the languages in decreasing order of preference. We have
  # more or less alphabetized them here. You probably want to change this.
  #
  LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nn no pl pt pt-BR ru sv tr zh-CN zh-TW

  #
  # ForceLanguagePriority allows you to serve a result page rather than
  # MULTIPLE CHOICES (Prefer) [in case of a tie] or NOT ACCEPTABLE (Fallback)
  # [in case no accepted languages matched the available variants]
  #
  ForceLanguagePriority Prefer Fallback
</IfModule>
<IfModule mod_setenvif.c>
  #
  # The following directives modify normal HTTP response behavior to
  # handle known problems with browser implementations.
  #
  BrowserMatch "Mozilla/2" nokeepalive
  BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
  BrowserMatch "RealPlayer 4\.0" force-response-1.0
  BrowserMatch "Java/1\.0" force-response-1.0
  BrowserMatch "JDK/1\.0" force-response-1.0

  #
  # The following directive disables redirects on non-GET requests for
  # a directory that does not include the trailing slash.  This fixes a
  # problem with Microsoft WebFolders which does not appropriately handle
  # redirects for folders with DAV methods.
  # Same deal with Apple's DAV filesystem and Gnome VFS support for DAV.
  #
  BrowserMatch "Microsoft Data Access Internet Publishing Provider" redirect-carefully
  BrowserMatch "MS FrontPage" redirect-carefully
  BrowserMatch "^WebDrive" redirect-carefully
  BrowserMatch "^WebDAVFS/1.[012]" redirect-carefully
  BrowserMatch "^gnome-vfs/1.0" redirect-carefully
  BrowserMatch "^gvfs/1" redirect-carefully
  BrowserMatch "^XML Spy" redirect-carefully
  BrowserMatch "^Dreamweaver-WebDAV-SCM1" redirect-carefully
  BrowserMatch " Konqueror/4" redirect-carefully
</IfModule>
<IfModule mod_ssl.c>
  #
  # Pseudo Random Number Generator (PRNG):
  # Configure one or more sources to seed the PRNG of the SSL library.
  # The seed data should be of good random quality.
  # WARNING! On some platforms /dev/random blocks if not enough entropy
  # is available. This means you then cannot use the /dev/random device
  # because it would lead to very long connection times (as long as
  # it requires to make more entropy available). But usually those
  # platforms additionally provide a /dev/urandom device which doesn't
  # block. So, if available, use this one instead. Read the mod_ssl User
  # Manual for more details.
  #
  SSLRandomSeed startup builtin
  SSLRandomSeed startup file:/dev/urandom 512
  SSLRandomSeed connect builtin
  SSLRandomSeed connect file:/dev/urandom 512

  ##
  ##  SSL Global Context
  ##
  ##  All SSL configuration in this context applies both to
  ##  the main server and all SSL-enabled virtual hosts.
  ##

  #
  #   Some MIME-types for downloading Certificates and CRLs
  #
  AddType application/x-x509-ca-cert .crt
  AddType application/x-pkcs7-crl    .crl

  #   Pass Phrase Dialog:
  #   Configure the pass phrase gathering process.
  #   The filtering dialog program (`builtin' is a internal
  #   terminal dialog) has to provide the pass phrase on stdout.
  SSLPassPhraseDialog builtin

  #   Inter-Process Session Cache:
  #   Configure the SSL Session Cache: First the mechanism
  #   to use and second the expiring timeout (in seconds).
  SSLSessionCache         shmcb:/var/cache/mod_ssl/scache(512000)
  SSLSessionCacheTimeout  300

  #   Semaphore:
  #   Configure the path to the mutual exclusion semaphore the
  #   SSL engine uses internally for inter-process synchronization.
  SSLMutex default

  #   SSL Cipher Suite:
  #   List the ciphers that the client is permitted to negotiate.
  #   See the mod_ssl documentation for a complete list.
  #   enable only secure ciphers:
  SSLCipherSuite EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:RC4!aNULL!eNULL!LOW!3DES!MD5!EXP!PSK!SRP!DSS

  #   Speed-optimized SSL Cipher configuration:
  #   If speed is your main concern (on busy HTTPS servers e.g.),
  #   you might want to force clients to specific, performance
  #   optimized ciphers. In this case, prepend those ciphers
  #   to the SSLCipherSuite list, and enable SSLHonorCipherOrder.
  #   Caveat: by giving precedence to RC4-SHA and AES128-SHA
  #   (as in the example below), most connections will no longer
  #   have perfect forward secrecy - if the server's key is
  #   compromised, captures of past or future traffic must be
  #   considered compromised, too.
  #SSLCipherSuite RC4-SHA:AES128-SHA:HIGH:MEDIUM:!aNULL:!MD5
  SSLHonorCipherOrder On

  #   The protocols to enable.
  #   Available values: all, SSLv3, TLSv1, TLSv1.1, TLSv1.2
  #   SSL v2  is no longer supported
  SSLProtocol All -SSLv2 -SSLv3

  #   Allow insecure renegotiation with clients which do not yet support the
  #   secure renegotiation protocol. Default: Off
  SSLInsecureRenegotiation Off



</IfModule>
<IfModule mod_status.c>
  #
  # Allow server status reports generated by mod_status,
  # with the URL of http://servername/server-status
  # Uncomment and change the ".example.com" to allow
  # access from other hosts.
  #
  <Location /server-status>
    SetHandler server-status
    Order deny,allow
    Deny from all
    Allow from 127.0.0.1 ::1
  </Location>

  #
  # ExtendedStatus controls whether Apache will generate "full" status
  # information (ExtendedStatus On) or just basic information (ExtendedStatus
  # Off) when the "server-status" handler is called. The default is Off.
  #
  ExtendedStatus On

</IfModule>





# Include ports listing
Listen *:80
NameVirtualHost *:80
Listen *:443
NameVirtualHost *:443

# The following directives define some format nicknames for use with
# a CustomLog directive (see below).
#
LogFormat "%v:%p %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" vhost_combined
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent


# Include generic snippets of statements
# Include /etc/httpd/conf-enabled/*.conf

# Include the virtual host configurations:
# Include /etc/httpd/sites-enabled/*.conf


<VirtualHost *:80>
  ServerName rtvstaging2.osuosl.org
  ServerAlias rtvstaging2-lb.osuosl.org 
  DocumentRoot /var/www/rocky/public

  RewriteRule ^/privacy.html http://www.rockthevote.com/voter-registration/online-application-system/privacy.html [R=permanent]

  # Rewrite floatbox and widget_loader.js requests to S3
  RewriteRule ^/floatbox/(.*)$ https://s3.amazonaws.com/floatbox/$1 [R=permanent]
  RewriteRule ^/widget_loader.js$ https://s3.amazonaws.com/ovr/widget_loader.js [R=permanent]

  # Display maintenance page if we're doing some work on the site
  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteRule ^.*$ /system/maintenance.html

  # Disable TRACE/TRACK http methods for security reasons
  RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
  RewriteRule .* - [F]

  ExpiresActive On
  ExpiresByType application/javascript "now plus 1 hour"
  ExpiresByType application/x-javascript "now plus 1 hour"
  ExpiresByType text/javascript "now plus 1 hour"
  ExpiresByType text/css "now plus 1 hour"

  EnableMMAP on
  EnableSendfile on

  <FilesMatch "\.(js|css)$">
    Header add Cache-Control "public"
  </FilesMatch>
  Header add Vary "Accept-Encoding"
  <FilesMatch "\.(js|css|png|jpg|gif|ico)$">
    FileETag None
  </FilesMatch>

  AddOutputFilterByType DEFLATE text/css application/javascript application/x-javascript text/html

  # send files as utf-8
  AddDefaultCharset utf-8

  # vim: set ft=apache :
  Redirect Permanent / https://rtvstaging2.osuosl.org/

  <Directory /var/www/rocky/public>
    Options FollowSymLinks
    AllowOverride ALL
    Order allow,deny
    Allow from all
  </Directory>

  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>

  <Location /server-status>
    SetHandler server-status
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
  </Location>

  LogLevel info
  CustomLog "|/usr/sbin/rotatelogs /var/log/httpd/rocky/access/%Y%m%d.log 86400" combined
  ErrorLog "|/usr/sbin/rotatelogs /var/log/httpd/rocky/error/%Y%m%d.log 86400"

</VirtualHost>

<VirtualHost *:443>
  ServerName rtvstaging2.osuosl.org
  ServerAlias rtvstaging2-lb.osuosl.org 
  DocumentRoot /var/www/rocky/public
  RewriteEngine On

  SSLEngine On
  SSLCertificateFile /etc/pki/tls/certs/wildcard.pem
  SSLCertificateKeyFile /etc/pki/tls/private/wildcard.key
  SSLCertificateChainFile /etc/pki/tls/certs/wildcard-bundle.crt

  RewriteRule ^/privacy.html http://www.rockthevote.com/voter-registration/online-application-system/privacy.html [R=permanent]

  # Rewrite floatbox and widget_loader.js requests to S3
  RewriteRule ^/floatbox/(.*)$ https://s3.amazonaws.com/floatbox/$1 [R=permanent]
  RewriteRule ^/widget_loader.js$ https://s3.amazonaws.com/ovr/widget_loader.js [R=permanent]

  # Display maintenance page if we're doing some work on the site
  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteRule ^.*$ /system/maintenance.html

  # Disable TRACE/TRACK http methods for security reasons
  RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
  RewriteRule .* - [F]

  ExpiresActive On
  ExpiresByType application/javascript "now plus 1 hour"
  ExpiresByType application/x-javascript "now plus 1 hour"
  ExpiresByType text/javascript "now plus 1 hour"
  ExpiresByType text/css "now plus 1 hour"

  EnableMMAP on
  EnableSendfile on

  <FilesMatch "\.(js|css)$">
    Header add Cache-Control "public"
  </FilesMatch>
  Header add Vary "Accept-Encoding"
  <FilesMatch "\.(js|css|png|jpg|gif|ico)$">
    FileETag None
  </FilesMatch>

  AddOutputFilterByType DEFLATE text/css application/javascript application/x-javascript text/html

  # send files as utf-8
  AddDefaultCharset utf-8

  # vim: set ft=apache :
  Redirect Permanent / https://rtvstaging2.osuosl.org/

  RailsBaseURI /
  RailsEnv staging
  PassengerRoot /home/ec2-user/.rvm/gems/ruby-1.9.3-p551@rocky6/gems/passenger-3.0.19
  PassengerRuby /home/ec2-user/.rvm/wrappers/ruby-1.9.3-p551@rocky6/ruby

  <Directory /var/www/rocky/public>
    Options FollowSymLinks
    AllowOverride ALL
    Order allow,deny
    Allow from all
  </Directory>

  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>

  <Location /server-status>
    SetHandler server-status
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
  </Location>

  LogLevel info
  CustomLog "|/usr/sbin/rotatelogs /var/log/httpd/rtvstaging.osuosl.org/access/%Y%m%d.log 86400" combined
  ErrorLog "|/usr/sbin/rotatelogs /var/log/httpd/rtvstaging.osuosl.org/error/%Y%m%d.log 86400"

</VirtualHost>


