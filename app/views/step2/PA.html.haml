- if !@registrant.use_short_form?
  %h1= t('txt.registration.step_2_header')
    
    
= form_for(@registrant, :url => registrant_step_2_path(@registrant)) do |form|
  - if @registrant.use_short_form?
    #other_language_link
      = form.select :new_locale, RockyConf.enabled_locales.collect {|loc| [t('txt.registration.in_language_name', :locale=>loc), loc]}, {}, onchange: "$(this.form).find('input[name=skip_advance]').val(true); $(this.form).submit()", value: @registrant.locale
      = form.hidden_field :locale, :value=>@registrant.locale      
      = hidden_field_tag 'skip_advance', false

          

  = render partial: 'name', locals: {form: form}

  - if @registrant.use_short_form?    
    %ul.checkbox.checkbox-step-1
      %li.spacer= "&nbsp;"
      %li.registrant-form__us-citizen__line
        %h3
          = form.check_box :us_citizen 
          = form.label :us_citizen
          %span.required *
          %span.error= form.object.errors[:us_citizen].join("\n")
          
    - if @registrant.require_age_confirmation?
      %ul.checkbox.checkbox-step-1
        %li.spacer
        %li.registrant-form__will-be-18-by-election__line
          %h3
            = form.check_box :will_be_18_by_election
            = form.label :will_be_18_by_election
            %span.error= form.object.errors[:will_be_18_by_election].join("\n")

    = render partial: 'previous_name', locals: { form: form }
    
  = render :partial=> "registrants/pa/home_address", :locals=>{:form=>form, home_extras: render(partial: "registrants/pa/home_county", locals: {form: form})}
  
  
  - if @registrant.use_short_form?
    
    = render partial: 'previous_address', locals: { form: form, extras: render(partial: "registrants/pa/prev_county", locals: {form: form}) }
    
    %fieldset.id-numbers
      %ul.flat
        %li.registrant-form__state-id-number__line
          %h3
            = form.label :state_id_number
            %span.required *
          .instructions
            %p= I18n.t('states.custom.pa.dln_instructions')
          = field_div form, :state_id_number, :size => 20
          %span.error= form.object.errors[:state_id_number].join("\n")


      %ul.checkbox
        %li.spacer &nbsp;
        %li.registrant-form__no-state-license__line
          %h3
            = form.check_box :does_not_have_state_id
            = form.label :does_not_have_state_id, I18n.t('txt.registration.has_no_state_license', state: @registrant.home_state_abbrev)

      .registrant-form__ssn4-group
        %ul.flat
          %li.registrant-form__ssn4__line
            %h3
              = form.label :ssn4
              %span.required *
            = field_div form, :ssn4, :size => 20
            %span.error= form.object.errors[:ssn4].join("\n")
    
        %ul.checkbox
          %li.spacer &nbsp;
          %li.registrant-form__no-ssn4__line
            %h3
              = form.check_box :does_not_have_ssn4
              = form.label :does_not_have_ssn4, I18n.t('txt.registration.has_no_ssn')
    
    - content_for :head do
      :javascript
        $(document).ready(function() {
          function hasStateLicense() {
            return !$('input[name="registrant[does_not_have_state_id]"]:checked').length == 1;
          }

          function hasSsn4() {
            return !$('input[name="registrant[does_not_have_ssn4]"]:checked').length == 1;
          }
          function hasAssistant() {
            return $('input[name="registrant[has_assistant]"]:checked').length == 1;            
          }
          
          
          function toggleAssistant() {
            if (hasAssistant()) {
              $('.registrant-form__assistant-fields').show();
            } else {
              $('.registrant-form__assistant-fields').hide();              
            }
          }
          
          function toggleDln() {
            if (hasStateLicense()) {
              $('.registrant-form__state-id-number__line').show();
            } else {
              $('.registrant-form__state-id-number__line').hide();              
            }
          }
          
          function toggleSsn4() {
            if (hasStateLicense()) {
               $('.registrant-form__ssn4-group').hide(); 
            } else {
              $('.registrant-form__ssn4-group').show();
              if (hasSsn4()) {
                $('.registrant-form__ssn4__line').show();
              } else {
                $('.registrant-form__ssn4__line').hide();                
              }
            }
          }
          toggleDln();     
          toggleSsn4();
          $('input[name="registrant[does_not_have_state_id]"]').click(function() {
            toggleSsn4();
            toggleDln();            
          });
          $('input[name="registrant[does_not_have_ssn4]"]').click(function() {
            toggleSsn4();
          });
          
          toggleAssistant();
          $('input[name="registrant[has_assistant]"]').click(function() {
            toggleAssistant();
          });
          
        });

    = render :partial=> "registrants/pa/race_and_party", :locals=>{:form=>form, party_extras: render(partial: "registrants/pa/party", locals: {form: form}), race_extras: render(partial: "registrants/pa/race", locals: {form: form})}
  
    %ul.flat.dob-and-phone
      = render :partial=> "registrants/date_of_birth", :locals=>{:form=>form}
      = render :partial=> "registrants/phone", :locals=>{:form=>form}
    
    %fieldset.no_border.opt-ins
      = render :partial=> 'registrants/phone_opt_ins', :locals=>{:form=>form, :show_hr=>true}
      = render :partial=> 'registrants/email_opt_ins', :locals=>{:form=>form}
    
      = render :partial=>'registrants/survey_and_volunteer', :locals=>{:form=>form}


    %fieldset.assistant
      %ul.checkbox
        %li.spacer= "&nbsp;"
        %li.registrant-form__has-assistant__line
          %h3
            = form.check_box :has_assistant 
            = form.label :has_assistant
            %span.error= form.object.errors[:has_assistant].join("\n")
      %ul.flat.registrant-form__assistant-fields
        %li.registrant-form__assistant-person-name__line.width_a
          %h3
            = form.label :assisted_person_name
            %span.required *
          = field_div form, :assisted_person_name
          %span.error= form.object.errors[:assisted_person_name].join("\n")          
        %li.registrant-form__assistant-person-address__line.width_a
          %h3
            = form.label :assisted_person_address
            %span.required *
          = field_div form, :assisted_person_address
          %span.error= form.object.errors[:assisted_person_address].join("\n")
        %li.registrant-form__assistant-person-phone__line.width_a
          %h3
            = form.label :assisted_person_phone
            %span.required *
          = field_div form, :assisted_person_phone
          %span.error= form.object.errors[:assisted_person_phone].join("\n")
        

    .use_state_registration
      = rollover_button(:prepare, I18n.t('txt.button.submit'))
  - else
    = render(:partial => 'previous', :locals => {:form => form}) unless @registrant.first_registration?
    %ul.flat
      = render :partial=> "registrants/phone", :locals=>{:form=>form}
    -#%hr

    = rollover_button(:next_step, I18n.t('txt.button.submit').html_safe)
  
  .back
    = link_to t('txt.button.back').html_safe, registrant_path(@registrant)
    
- if @registrant.use_short_form?
  %p.already-registered= I18n.t('txt.registration.already_registered', url: ( "/share?registrant_finish_iframe_url=#{CGI.escape(@registrant.finish_iframe_url)}")).html_safe
