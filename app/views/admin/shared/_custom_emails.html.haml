%div.whitelabeled
  Select template's language and category:
  %select#email-locale-select.template-select
    - I18n.available_locales.each do |loc|
      %option(value=loc){ (loc.to_s=='en') ? { selected: '' } : {} }= loc.upcase
  %select#email-type-select.template-select
    - EmailTemplate::EMAIL_TYPES.each do |type|
      %option(value=type){ (type == 'confirmation') ? { selected: '' } : {} }= type.humanize
  - prefix ||= ""
  - EmailTemplate::TEMPLATE_NAMES.each do |name, label|
    %ul(class="stacked email-template email-template-#{name.sub(".", "--")}")
      %li.width_h
        %h3
          %label= label
        = text_field_tag "template_subject[#{prefix + name}]", EmailTemplate.get_subject(@partner, prefix + name), :rows => 5
        %br
        %br
        = text_area_tag "template[#{prefix + name}]", EmailTemplate.get(@partner, prefix + name), :rows => 5
        %br
        %br
        %p
          Save your changes to preview the result. Save empty message to load default values.
        %div.email-preview
          - kind = name.split(".").first
          - locale = name.split(".").last
          = Notifier.preview_message(@partner, prefix + kind, locale).body.to_s.html_safe
